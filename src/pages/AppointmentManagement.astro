---
// Management Dashboard Component
import Layout from '../layouts/Layout.astro';
---

<Layout title="Gestión de Citas">
  <main class="flex min-h-screen bg-gray-100">
    <!-- Sidebar -->
    <aside class="bg-blue-500 text-white w-1/5 flex flex-col items-center py-6 space-y-8">
      <div class="flex flex-col items-center space-y-4">
        <img src="/icons/heart-icon.svg" alt="Logo" class="w-8 h-8" />
      </div>
      <nav class="space-y-6 text-center">
        <button
          class="flex items-center space-x-4 hover:bg-blue-600 px-4 py-2 w-full"
          id="inicio"
        >
          <i class="fas fa-home w-6 h-6"></i>
          <span>Inicio</span>
        </button>
        <button
          class="flex items-center space-x-4 hover:bg-blue-600 px-4 py-2 w-full"
          id="citas"
        >
          <i class="fas fa-calendar-alt w-6 h-6"></i>
          <span>Agendar Cita</span>
        </button>
      
      </nav>
    </aside>

    <!-- Main Content -->
    <section class="flex-grow p-8 bg-white" id="mainContent">
      <!-- Header -->
      <header class="flex justify-between items-center mb-6">
        <div>
          <h2 id="dashboard-title" class="text-2xl font-semibold">Gestión de Citas</h2>
          <p class="text-gray-600">Administrar, editar, filtrar y eliminar citas</p>
        </div>
      </header>

      <!-- Filters Section -->
      <div class="space-y-4 bg-gray-50 p-6 rounded-lg shadow-lg mb-8">
        <h3 class="text-xl font-bold text-gray-800">Filtros</h3>
        <div class="grid grid-cols-4 gap-4">
          <!-- Search by Name -->
          <div>
            <label for="search-name" class="block text-sm font-medium text-gray-700">Nombre:</label>
            <input
              type="text"
              id="search-name"
              class="mt-1 block w-full p-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500"
              placeholder="Buscar por nombre"
            />
          </div>
          <!-- Filter by Appointment Type -->
          <div>
            <label for="filter-type" class="block text-sm font-medium text-gray-700">Tipo de cita:</label>
            <select
              id="filter-type"
              class="mt-1 block w-full p-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500"
            >
              <option value="">Todos</option>
              <option value="regular">Regular</option>
              <option value="emergency">Emergencia</option>
            </select>
          </div>
          <!-- Filter by Status -->
          <div>
            <label for="filter-status" class="block text-sm font-medium text-gray-700">Estado:</label>
            <select
              id="filter-status"
              class="mt-1 block w-full p-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500"
            >
              <option value="">Todos</option>
              <option value="critico">Crítico</option>
              <option value="estable">Estable</option>
            </select>
          </div>
          <!-- Filter by Department -->
          <div>
            <label for="filter-department" class="block text-sm font-medium text-gray-700">Departamento:</label>
            <select
              id="filter-department"
              class="mt-1 block w-full p-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500"
            >
              <option value="">Todos</option>
              <option value="cardiologia">Cardiología</option>
              <option value="neurologia">Neurología</option>
              <option value="pediatria">Pediatría</option>
            </select>
          </div>
        </div>
        <button
          id="apply-filters"
          class="mt-4 py-2 px-4 bg-blue-500 text-white font-medium rounded-md shadow-md hover:bg-blue-600"
        >
          Aplicar Filtros
        </button>
      </div>

      <!-- Appointment Table -->
      <div class="bg-gray-50 p-6 rounded-lg shadow-lg">
        <h3 class="text-xl font-bold text-gray-800 mb-4">Citas</h3>
        <table class="min-w-full table-auto border-collapse border border-gray-300">
          <thead>
            <tr class="bg-blue-500 text-white">
              <th class="border border-gray-300 px-4 py-2">ID</th>
              <th class="border border-gray-300 px-4 py-2">Nombre</th>
              <th class="border border-gray-300 px-4 py-2">Tipo</th>
              <th class="border border-gray-300 px-4 py-2">Estado</th>
              <th class="border border-gray-300 px-4 py-2">Departamento</th>
              <th class="border border-gray-300 px-4 py-2">Acciones</th>
            </tr>
          </thead>
          <tbody id="appointment-list" class="text-gray-700">
            <!-- Rows will be dynamically populated -->
          </tbody>
        </table>
      </div>
    </section>
  </main>

  <script>
    const appointments = [
      { id: 1, name: 'Juan Pérez', type: 'regular', status: 'estable', department: 'Cardiología' },
      { id: 2, name: 'Ana Gómez', type: 'emergency', status: 'critico', department: 'Neurología' },
    ];

    const appointmentList = document.getElementById('appointment-list');

    function renderAppointments(filteredAppointments) {
      appointmentList.innerHTML = '';
      filteredAppointments.forEach((appointment) => {
        const row = document.createElement('tr');
        row.innerHTML = `
          <td class="border border-gray-300 px-4 py-2">${appointment.id}</td>
          <td class="border border-gray-300 px-4 py-2">${appointment.name}</td>
          <td class="border border-gray-300 px-4 py-2">${appointment.type}</td>
          <td class="border border-gray-300 px-4 py-2">${appointment.status}</td>
          <td class="border border-gray-300 px-4 py-2">${appointment.department}</td>
          <td class="border border-gray-300 px-4 py-2">
            <button class="text-blue-500 hover:underline edit-btn" data-id="${appointment.id}">Editar</button>
            <button class="text-red-500 hover:underline delete-btn" data-id="${appointment.id}">Eliminar</button>
          </td>
        `;
        appointmentList.appendChild(row);
      });

      document.querySelectorAll('.edit-btn').forEach((btn) => {
        btn.addEventListener('click', (event) => {
          const id = event.target.dataset.id;
          alert(`Editar cita con ID: ${id}`);
        });
      });

      document.querySelectorAll('.delete-btn').forEach((btn) => {
        btn.addEventListener('click', (event) => {
          const id = event.target.dataset.id;
          const index = appointments.findIndex((a) => a.id == id);
          if (index > -1) {
            appointments.splice(index, 1);
            renderAppointments(appointments);
          }
        });
      });
    }

    document.getElementById('apply-filters').addEventListener('click', () => {
      const searchName = document.getElementById('search-name').value.toLowerCase();
      const filterType = document.getElementById('filter-type').value;
      const filterStatus = document.getElementById('filter-status').value;
      const filterDepartment = document.getElementById('filter-department').value;

      const filtered = appointments.filter((appointment) => {
        return (
          (searchName === '' || appointment.name.toLowerCase().includes(searchName)) &&
          (filterType === '' || appointment.type === filterType) &&
          (filterStatus === '' || appointment.status === filterStatus) &&
          (filterDepartment === '' || appointment.department === filterDepartment)
        );
      });

      renderAppointments(filtered);
    });

    // Sidebar Navigation
    document.getElementById('inicio').addEventListener('click', () => {
      window.location.href = '/Views/GeneralReceptionist';
    });
    document.getElementById('citas').addEventListener('click', () => {
      window.location.href = 'Views/GeneralReceptionist?section=createAppointment';    });

    // Initial render
    renderAppointments(appointments);
  </script>
</Layout>
